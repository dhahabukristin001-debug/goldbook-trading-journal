<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>GOLDBOOK â€” Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0a0600;--panel:#140e00;--panel2:#1a1200;
  --gold:#f5c518;--gold2:#c8860a;--gold3:#8b5e00;
  --text:#f0e6c8;--dim:#6b4f00;--dim2:#3a2800;
  --profit:#d4a843;--loss:#cc4400;--border:rgba(245,197,24,0.18);
}
body{background:var(--bg);color:var(--text);font-family:'Share Tech Mono',monospace;font-size:13px;min-height:100vh}
body::before{content:'';position:fixed;inset:0;pointer-events:none;
  background:radial-gradient(ellipse at 50% -20%,rgba(245,197,24,0.06) 0%,transparent 60%);}

/* NAV */
nav{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 24px;background:rgba(20,14,0,0.97);
  border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;
}
.nav-logo{display:flex;align-items:center;gap:12px}
.nav-logo-box{
  width:36px;height:36px;border-radius:8px;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  display:flex;align-items:center;justify-content:center;
  font-family:'Cinzel',serif;font-weight:700;font-size:13px;color:var(--bg);
}
.nav-title{font-family:'Cinzel',serif;font-size:16px;color:var(--gold);letter-spacing:3px}
.nav-links{display:flex;gap:4px}
.nav-link{
  padding:7px 14px;border-radius:6px;font-size:10px;letter-spacing:2px;
  color:var(--dim);text-decoration:none;transition:all 0.2s;border:1px solid transparent;
}
.nav-link:hover,.nav-link.active{background:rgba(245,197,24,0.1);color:var(--gold);border-color:var(--border)}
.nav-right{display:flex;align-items:center;gap:12px}
.acc-badge{
  background:rgba(245,197,24,0.08);border:1px solid var(--border);
  border-radius:6px;padding:5px 12px;font-size:10px;color:var(--gold);letter-spacing:1px;
}
.logout{font-size:10px;color:var(--dim);text-decoration:none;letter-spacing:1px}
.logout:hover{color:var(--loss)}

/* MAIN */
.main{padding:20px 24px;max-width:1400px;margin:0 auto}

/* STAT CARDS */
.stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:20px}
@media(max-width:900px){.stat-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:500px){.stat-grid{grid-template-columns:1fr}}
.stat-card{
  background:var(--panel2);border:1px solid var(--border);
  border-radius:14px;padding:18px 20px;position:relative;overflow:hidden;
  animation:fadeUp 0.4s ease both;
}
.stat-card::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,var(--gold),transparent);
  opacity:0.4;
}
.stat-label{font-size:9px;color:var(--dim);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px}
.stat-val{font-family:'Cinzel',serif;font-size:24px;font-weight:700;color:var(--gold)}
.stat-val.profit{color:var(--profit)}
.stat-val.loss{color:var(--loss)}
.stat-sub{font-size:10px;color:var(--dim);margin-top:6px}

/* SECTION */
.section{margin-bottom:20px}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.panel-head{
  padding:12px 20px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  background:rgba(245,197,24,0.02);
}
.panel-title{font-family:'Cinzel',serif;font-size:12px;color:var(--gold);letter-spacing:2px}
.panel-body{padding:20px}

/* TWO COL */
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:800px){.two-col{grid-template-columns:1fr}}

/* CALENDAR */
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;font-size:9px}
.cal-day-name{text-align:center;color:var(--dim);padding:4px;letter-spacing:1px}
.cal-cell{
  aspect-ratio:1;border-radius:4px;display:flex;flex-direction:column;
  align-items:center;justify-content:center;font-size:8px;
  background:var(--dim2);cursor:default;transition:transform 0.1s;
}
.cal-cell:hover{transform:scale(1.1);z-index:2}
.cal-cell .day-num{font-size:9px;color:var(--dim);margin-bottom:2px}
.cal-cell .day-pnl{font-size:8px;font-weight:700}
.cal-cell.profit-day{background:rgba(212,168,67,0.2)}
.cal-cell.loss-day{background:rgba(204,68,0,0.2)}
.cal-cell.profit-day .day-pnl{color:var(--profit)}
.cal-cell.loss-day .day-pnl{color:var(--loss)}

@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

@media(max-width:600px){
  nav{flex-wrap:wrap;gap:8px}
  .nav-links{order:3;width:100%;justify-content:center}
  .main{padding:12px}
}
</style>
</head>
<body>
<nav>
  <div class="nav-logo">
    <div class="nav-logo-box">GB</div>
    <div>
      <div class="nav-title">GOLDBOOK</div>
    </div>
  </div>
  <div class="nav-links">
    <a href="/dashboard" class="nav-link active">OVERVIEW</a>
    <a href="/trades"    class="nav-link">TRADES</a>
    <a href="/analytics" class="nav-link">ANALYTICS</a>
  </div>
  <div class="nav-right">
    <div class="acc-badge">{{ account_number }}</div>
    <a href="/logout" class="logout">LOGOUT</a>
  </div>
</nav>

<div class="main">

  <!-- STAT CARDS -->
  <div class="stat-grid" id="stat-grid">
    <div class="stat-card" style="animation-delay:0s"><div class="stat-label">Total Profit</div><div class="stat-val" id="s-profit">--</div><div class="stat-sub" id="s-trades">-- trades</div></div>
    <div class="stat-card" style="animation-delay:0.1s"><div class="stat-label">Win Rate</div><div class="stat-val" id="s-wr">--%</div><div class="stat-sub" id="s-wl">--W / --L</div></div>
    <div class="stat-card" style="animation-delay:0.2s"><div class="stat-label">Profit Factor</div><div class="stat-val" id="s-pf">--</div><div class="stat-sub" id="s-exp">Expectancy: --</div></div>
    <div class="stat-card" style="animation-delay:0.3s"><div class="stat-label">Sharpe Ratio</div><div class="stat-val" id="s-sr">--</div><div class="stat-sub" id="s-dd">Max DD: --</div></div>
    <div class="stat-card" style="animation-delay:0.4s"><div class="stat-label">Avg Win</div><div class="stat-val profit" id="s-aw">--</div><div class="stat-sub">per winning trade</div></div>
    <div class="stat-card" style="animation-delay:0.5s"><div class="stat-label">Avg Loss</div><div class="stat-val loss" id="s-al">--</div><div class="stat-sub">per losing trade</div></div>
    <div class="stat-card" style="animation-delay:0.6s"><div class="stat-label">Max Consec. Wins</div><div class="stat-val" id="s-cw">--</div><div class="stat-sub" id="s-cl">Max Losses: --</div></div>
    <div class="stat-card" style="animation-delay:0.7s"><div class="stat-label">Gross Profit</div><div class="stat-val profit" id="s-gp">--</div><div class="stat-sub" id="s-gl">Gross Loss: --</div></div>
  </div>

  <!-- EQUITY CURVE -->
  <div class="section panel">
    <div class="panel-head">
      <span class="panel-title">ðŸ“ˆ EQUITY CURVE</span>
      <span style="font-size:9px;color:var(--dim)">Balance over time</span>
    </div>
    <div class="panel-body">
      <canvas id="equityChart" height="80"></canvas>
    </div>
  </div>

  <!-- P&L CALENDAR -->
  <div class="section panel">
    <div class="panel-head">
      <span class="panel-title">ðŸ“… P&L CALENDAR</span>
      <select id="cal-month" style="background:var(--panel2);border:1px solid var(--border);color:var(--gold);padding:4px 8px;border-radius:4px;font-size:10px;outline:none"></select>
    </div>
    <div class="panel-body">
      <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:6px">
        <div style="text-align:center;font-size:9px;color:var(--dim);padding:4px">MON</div>
        <div style="text-align:center;font-size:9px;color:var(--dim);padding:4px">TUE</div>
        <div style="text-align:center;font-size:9px;color:var(--dim);padding:4px">WED</div>
        <div style="text-align:center;font-size:9px;color:var(--dim);padding:4px">THU</div>
        <div style="text-align:center;font-size:9px;color:var(--dim);padding:4px">FRI</div>
        <div style="text-align:center;font-size:9px;color:var(--dim);padding:4px">SAT</div>
        <div style="text-align:center;font-size:9px;color:var(--dim);padding:4px">SUN</div>
      </div>
      <div class="calendar-grid" id="cal-grid"></div>
    </div>
  </div>

</div>

<script>
let allStats = null;
const gold   = '#f5c518', goldDim = '#8b5e00', bg = '#0a0600';

Chart.defaults.color = '#6b4f00';
Chart.defaults.borderColor = 'rgba(245,197,24,0.08)';

let equityChart = null;

async function loadData() {
  const res = await fetch('/api/stats');
  const d   = await res.json();
  allStats   = d;

  const st = d.stats || {};
  const pnl = st.total_profit || 0;
  document.getElementById('s-profit').textContent = (pnl>=0?'+':'')+pnl.toFixed(2)+' USD';
  document.getElementById('s-profit').className   = 'stat-val '+(pnl>=0?'profit':'loss');
  document.getElementById('s-trades').textContent = (st.total_trades||0)+' total trades';
  document.getElementById('s-wr').textContent     = (st.win_rate||0)+'%';
  document.getElementById('s-wl').textContent     = (st.win_count||0)+'W / '+(st.loss_count||0)+'L';
  document.getElementById('s-pf').textContent     = st.profit_factor||'--';
  document.getElementById('s-exp').textContent    = 'Expectancy: '+(st.expectancy||0);
  document.getElementById('s-sr').textContent     = st.sharpe_ratio||'--';
  document.getElementById('s-dd').textContent     = 'Max DD: $'+(st.max_drawdown||0);
  document.getElementById('s-aw').textContent     = '+'+(st.avg_win||0)+' USD';
  document.getElementById('s-al').textContent     = (st.avg_loss||0)+' USD';
  document.getElementById('s-cw').textContent     = st.max_consec_wins||0;
  document.getElementById('s-cl').textContent     = 'Max Losses: '+(st.max_consec_losses||0);
  document.getElementById('s-gp').textContent     = '+'+(st.gross_profit||0)+' USD';
  document.getElementById('s-gl').textContent     = 'Gross Loss: '+(st.gross_loss||0)+' USD';

  // Equity curve
  const eq = d.equity_curve || [];
  if(equityChart) equityChart.destroy();
  const ctx = document.getElementById('equityChart').getContext('2d');
  const grad = ctx.createLinearGradient(0,0,0,300);
  grad.addColorStop(0,'rgba(245,197,24,0.3)');
  grad.addColorStop(1,'rgba(245,197,24,0)');
  equityChart = new Chart(ctx,{
    type:'line',
    data:{
      labels: eq.map(e=>e.time?.slice(0,10)||''),
      datasets:[{
        label:'Balance',
        data: eq.map(e=>e.balance),
        borderColor: gold, backgroundColor: grad,
        borderWidth:2, pointRadius:0, fill:true, tension:0.4
      }]
    },
    options:{
      responsive:true,plugins:{legend:{display:false}},
      scales:{
        x:{ticks:{maxTicksLimit:8,font:{size:9}},grid:{color:'rgba(245,197,24,0.05)'}},
        y:{ticks:{font:{size:9}},grid:{color:'rgba(245,197,24,0.05)'}}
      }
    }
  });

  // Calendar
  buildCalendar(d.calendar||{});
}

function buildCalendar(cal) {
  // Get months for dropdown
  const months = [...new Set(Object.keys(cal).map(d=>d.slice(0,7)))].sort().reverse();
  const sel = document.getElementById('cal-month');
  sel.innerHTML = months.map(m=>`<option value="${m}">${m}</option>`).join('') || '<option>No data</option>';
  sel.onchange = ()=>renderMonth(cal, sel.value);
  if(months.length) renderMonth(cal, months[0]);
}

function renderMonth(cal, month) {
  const grid   = document.getElementById('cal-grid');
  const [y,m]  = month.split('-').map(Number);
  const first  = new Date(y,m-1,1).getDay(); // 0=Sun
  const days   = new Date(y,m,0).getDate();
  // Adjust: Monday=0
  const offset = (first===0)?6:first-1;
  let html = '';
  for(let i=0;i<offset;i++) html += '<div></div>';
  for(let d=1;d<=days;d++){
    const key = `${month}-${String(d).padStart(2,'0')}`;
    const pnl = cal[key];
    let cls='cal-cell', pnlTxt='';
    if(pnl!==undefined){
      cls += pnl>=0?' profit-day':' loss-day';
      pnlTxt = `<span class="day-pnl">${pnl>=0?'+':''}${pnl}</span>`;
    }
    html += `<div class="${cls}" title="${key}: ${pnl||'No trades'}"><span class="day-num">${d}</span>${pnlTxt}</div>`;
  }
  grid.innerHTML = html;
}

loadData();
setInterval(loadData, 30000);
</script>
</body>
</html>
